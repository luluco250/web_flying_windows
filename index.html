<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
	<head>
		<title>Flying Windows</title>
		<style>
			html, body {
				background-color: black;
				width: 100%;
				height: 100%;
				margin: 0;
				border: 0;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<img id="logo" hidden="true" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPg0KPHN2ZyB3aWR0aD0iMTc5LjgxIiBoZWlnaHQ9IjE0NCIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNDcuNTc1Mzg4IDM4LjA5OTk5MyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+PG1ldGFkYXRhPjxyZGY6UkRGPjxjYzpXb3JrIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZSByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIi8+PGRjOnRpdGxlLz48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQxLjYwMSAtMjAzLjM0KSI+PGcgZmlsbD0iI2ZmZiIgYXJpYS1sYWJlbD0iw78iPjxwYXRoIGQ9Im00My4yODggMjA2LjM0djEuNDYzNWwtMS42ODY3IDAuNjk0NTN2LTEuNDM4N3ptLTAuMTczNjMgNC43Mzc3djEuMzE0NmwtMS4zNjQzIDAuNjIwMTF2LTEuMjg5OHptMCA0Ljc2MjV2MS4yODk4bC0xLjM2NDMgMC42MjAxMnYtMS4yODk4em0wLjE3MzYzIDQuNjg4MXYxLjQ2MzVsLTEuNjg2NyAwLjY5NDUzdi0xLjQxMzl6bS0wLjE3MzYzIDQuOTM2MXYxLjI2NWwtMS4zNjQzIDAuNjIwMTF2LTEuMjg5OHptMCA0LjgxMjF2MS4yODk4bC0xLjM2NDMgMC42MjAxMnYtMS4yNjV6bTAuMTczNjMgNC42Mzg1djEuNDg4M2wtMS42ODY3IDAuNjk0NTN2LTEuNDEzOXptNC4yNjY0LTI3Ljc1NnYxLjcxMTVsLTIuMjgyIDAuODY4MTZ2LTEuNjg2N3ptLTAuMTI0MDIgNC45NjA5djEuNTYyN2wtMS44MzU1IDAuNzE5MzR2LTEuNTYyN3ptMCA0Ljc4NzN2MS41Mzc5bC0xLjgzNTUgMC43MTkzNHYtMS41ODc1em0wLjEyNDAyIDQuNjEzN3YxLjY4NjdsLTIuMjgyIDAuODkyOTd2LTEuNjg2N3ptLTAuMTI0MDIgNC45NjA5djEuNTM3OWwtMS44MzU1IDAuNzQ0MTR2LTEuNTg3NXptMCA0LjgzNjl2MS41Mzc5bC0xLjgzNTUgMC43NDQxNHYtMS41NjI3em0wLjEyNDAyIDQuNjM4NXYxLjY4NjdsLTIuMjgyIDAuOTQyNTh2LTEuNjg2N3ptNC4yNjY0LTI3LjczMnYyLjAzNGwtMi45NTE4IDEuMTY1OHYtMi4wMDkyem0tMC4xNDg4MyA0Ljk4NTd2MS44MTA3bC0yLjQ4MDUgMC45NjczOXYtMS43NjExem0wIDQuNzg3M3YxLjc4NTlsLTIuNDgwNSAwLjk5MjE5di0xLjc4NTl6bTAuMTQ4ODMgNC41ODg5djIuMDM0bC0yLjk1MTggMS4xNjU4di0yLjAwOTJ6bS0wLjE0ODgzIDQuOTg1N3YxLjc4NTlsLTIuNDgwNSAxLjAxN3YtMS43ODU5em0wIDQuNjM4NXYxLjgzNTZsLTIuNDgwNSAwLjk5MjE5di0xLjc4NTl6bTAuMTQ4ODMgNC42Mzg1djIuMDM0bC0yLjk1MTggMS4xOTA2di0yLjAzNHptNC42NjMzLTI4Ljc0OXYyLjY3ODlsLTMuNjk1OSAxLjQ4ODN2LTIuNjU0MXptLTAuMTk4NDQgNC45ODU3djIuNDU1N2wtMy4xMDA2IDEuMjY1di0yLjQ1NTd6bTAgNC43ODczdjIuNDMwOWwtMy4xMDA2IDEuMjY1di0yLjQ1NTd6bTAuMTk4NDQgNC42MTM3djIuNjc4OWwtMy42OTU5IDEuNDYzNXYtMi42Nzg5em0tMC4xOTg0NCA0Ljk4NTh2Mi40NTU3bC0zLjEwMDYgMS4yNDAydi0yLjQ1NTd6bTAgNC42Mzg1djIuNDU1N2wtMy4xMDA2IDEuMjQwMnYtMi40MzA5em0wLjE5ODQ0IDQuNjEzN3YyLjY3ODlsLTMuNjk1OSAxLjQ4ODN2LTIuNjU0MXptNC44ODY1LTI5LjA3MXYzLjQ5NzVsLTQuMTE3NiAxLjY4Njd2LTMuNDk3NXptLTAuMTk4NDQgNS4yNTg2djIuOTI3bC0zLjUyMjMgMS40MTM5di0yLjk1MTh6bTAgNC41NjQxdjIuOTUxOGwtMy41MjIzIDEuMzg5MXYtMi45Mjd6bTAuMTk4NDQgNC41MzkydjMuNDk3NWwtNC4xMTc2IDEuNjYxOXYtMy40OTc1em0tMC4xOTg0NCA1LjIzMzh2Mi45NzY2bC0zLjUyMjMgMS4zNjQydi0yLjkyN3ptMCA0LjY2MzN2Mi45NTE4bC0zLjUyMjMgMS40MTM5di0yLjk1MTh6bTAuMTk4NDQgNC4zNjU2djMuNDk3NWwtNC4xMTc2IDEuNjYxOXYtMy40OTc1em00Ljk4NTctMzAuMzg2djQuNzg3M2wtNC4zOTA0IDEuODM1NnYtNC40NjQ4cTIuMjgyLTEuMzE0NiA0LjM5MDQtMi4xNTh6bTAgNS4yODM0djQuMTQyNGwtNC4zOTA0IDEuODYwNHYtNC4xNjcyem0wIDQuNjYzM3Y0LjE5MmwtNC4zOTA0IDEuODYwNHYtNC4xOTJ6bTAgNC43MTI5djQuMTQyNGwtNC4zOTA0IDEuODYwNHYtNC4xNjcyem0wIDQuNjYzM3Y0LjI2NjRsLTQuMzkwNCAxLjg4NTJ2LTQuMjkxMnptMCA0Ljc4NzN2NC4xNjcybC00LjM5MDQgMS45MXYtNC4yMTY4em0wIDQuNjg4MXY0LjQ2NDhxLTIuNTc5NyAwLjk5MjE5LTQuMzkwNCAxLjkxdi00LjQ4OTZ6bTIyLjgyLTI4LjYyNXYzMy41MTFxLTQuMjQxNi0yLjc3ODEtMTAuNTkyLTIuNzc4MS01LjI1ODYgMC0xMS43NTcgMi4xODI4di00LjQ2NDhxMy40NDc5LTEuMzY0MyA3LjU5MDItMS45NTk2di0xMC45MTRxLTMuNDk3NSAwLjQ0NjQ5LTcuNTkwMiAyLjQzMDl2LTMuMTk5OHEzLjU0NzEtMS42MzcxIDcuNTkwMi0yLjIzMjR2LTEwLjU5MnEtMy42NDYzIDAuNjk0NTMtNy41OTAyIDIuMzU2NHYtNC43MTI5cTUuNzc5NS0yLjM1NjQgMTEuMzM2LTIuMzU2NCA1Ljk3NzkgMCAxMS4wMTMgMi43Mjg1em0tNC4zOTA0IDMuMDAxNHEtMi43NTMzLTEuMzg5MS02LjU5OC0xLjM4OTEtMC40NDY0OCAwLTAuODkyOTcgMC4wNDk2djEwLjcxNmwwLjk5MjE5LTAuMDI0OHEzLjI5OSAwIDYuNDk4OCAxLjA0MTh6bTAgMTMuNTY4cS0yLjk1MTgtMS4yODk4LTYuNTQ4NC0xLjI4OTgtMC40NDY0OCAwLTAuOTQyNTggMC4wNDk2djEwLjkxNGgwLjk5MjE5cTMuNTk2NyAwIDYuNDk4OCAwLjg5Mjk3em0yLjg3NzMgMTguMzA2di0wLjcxOTMzaC0wLjI5NzY2di0wLjEyNDAzaDAuNzE5MzR2MC4xMjQwM2gtMC4yOTc2NnYwLjcxOTMzem0wLjUyMDkgMHYtMC44NDMzNmgwLjE5ODQ0bDAuMjk3NjYgMC42NDQ5MiAwLjI5NzY2LTAuNjQ0OTJoMC4xOTg0NHYwLjg0MzM2aC0wLjEyNDAydi0wLjY5NDUzbC0wLjI5NzY2IDAuNjQ0OTJoLTAuMTQ4ODNsLTAuMjk3NjYtMC42NDQ5MnYwLjY5NDUzeiIgZmlsbD0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIuMjY0NTgiLz48L2c+PC9nPjwvc3ZnPg0K"/>
		<script>
			window.onload = function() {
				"use strict";

				// Constants
				const MIN_DEPTH = 0;
				const MAX_DEPTH = 100;
				const LOGO_SPEED = 100;
				const LOGO_COUNT = 100;
				const LOGO_SCALE = 0.75;
				const MAX_DT = 0.5;
				const FPS = 15;

				// Globals
				const canvas = document.getElementById("canvas");
				const ctx = canvas.getContext("2d");
				var last_time = performance.now();
				var dt = 0.0;
				const logo_source = document.getElementById("logo");
				const inv_fps = 1 / FPS;

				// Helper functions
				function rand(min, max) {
					return Math.random() * (max - min) + min;
				}
				function width() { return window.innerWidth; } //document.body.offsetWidth; }
				function height() { return window.innerHeight; } //document.body.offsetHeight; }
				function normalize(x, min, max) {
					return (x - min) / (max - min);
				}
				function hex2rgb(hex) {
					const rgb = parseInt(hex, 16);
					return [(rgb >> 16) & 255, (rgb >> 8) & 255, rgb & 255];
				}
				function colorize(img, color) {
					// Get RGB values from hex color string
					const rgb = hex2rgb(color);

					// Create temp buffer to manipulate the image
					const buffer = document.createElement("canvas");
					buffer.width = img.width;
					buffer.height = img.height;
					const ctx = buffer.getContext("2d");
					ctx.drawImage(img, 0, 0);

					// Get access to the raw pixel data
					const imgdata = ctx.getImageData(0, 0, img.width, img.height);
					const data = imgdata.data;

					// Replace the buffer's RGB values, but keep the alpha
					for (var p = 0; p < (img.width * img.height * 4); p += 4) {
						data[p] = rgb[0];
						data[p + 1] = rgb[1];
						data[p + 2] = rgb[2];
					}

					// Save the changes
					ctx.putImageData(imgdata, 0, 0);
					return buffer;
				}

				// Create colorized variants
				const logo_images = [
					colorize(logo_source, "000000"),
					colorize(logo_source, "800000"),
					colorize(logo_source, "008000"),
					colorize(logo_source, "808000"),
					colorize(logo_source, "000080"),
					colorize(logo_source, "000080"),
					colorize(logo_source, "008080"),
					colorize(logo_source, "C0C0C0"),
					colorize(logo_source, "C0DCC0"),
					colorize(logo_source, "A6CAF0"),
					colorize(logo_source, "FFFBF0"),
					colorize(logo_source, "A0A0A4"),
					colorize(logo_source, "808080"),
					colorize(logo_source, "FF0000"),
					colorize(logo_source, "00FF00"),
					colorize(logo_source, "FFFF00"),
					colorize(logo_source, "0000FF"),
					colorize(logo_source, "FF00FF"),
					colorize(logo_source, "00FFFF"),
					colorize(logo_source, "FFFFFF")
				];

				class Logo {
					constructor(image) {
						this.regenerate(rand(MIN_DEPTH, MAX_DEPTH));
					}

					regenerate(depth) {
						this.depth = depth || MIN_DEPTH;
						this.start_x = rand(0, width());
						this.start_y = rand(0, height());
						this.dir_x = (this.start_x - width() * 0.5);
						this.dir_y = (this.start_y - height() * 0.5);
						this.image = logo_images[Math.floor(rand(0, logo_images.length))];
					}

					update() {
						this.depth += LOGO_SPEED * dt;
						
						const z = normalize(this.depth, MIN_DEPTH, MAX_DEPTH);
						const w = z * this.image.width * LOGO_SCALE;
						const h = z * this.image.height * LOGO_SCALE;
						
						ctx.drawImage(
							this.image,
							z * this.dir_x + this.start_x - w * 0.5,
							z * this.dir_y + this.start_y - h * 0.5,
							w, h
						);

						if (this.depth > MAX_DEPTH)
							this.regenerate();
					}
				}

				// Setup
				const logos = new Array(LOGO_COUNT);
				for (var i = 0; i < LOGO_COUNT; ++i)
					logos[i] = new Logo();

				canvas.width = width();
				canvas.height = height();
				window.onresize = function(e) {
					canvas.width = width();
					canvas.height = height();
				}

				// Main loop
				requestAnimationFrame(function loop(curr_time) {
					requestAnimationFrame(loop);
					dt = (curr_time - last_time) * 0.001;

					// Framerate limiting
					if (dt > inv_fps) {
						last_time = curr_time;

						// Wait for the next frame if the time difference
						// is too high. This prevents a glitch where
						// minimizing or switching tabs caused all logos
						// to go to the same depth, losing the randomness.
						if (dt <= MAX_DT) {

							// Finally render the image
							ctx.clearRect(0, 0, canvas.width, canvas.height);
							for (var i = 0; i < LOGO_COUNT; ++i)
								logos[i].update();
						}
					}
				});
			}
		</script>
	</body>
</html>