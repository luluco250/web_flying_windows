<!DOCTYPE html>
<meta charset="utf-8"/>
<html>
	<head>
		<title>Flying Windows</title>
		<style>
			* {
				background: black;
				width: 100%;
				height: 100%;
				margin: 0;
				border: 0;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<img id="logo" src="logo.svg" hidden="true"/>
		<script>
			window.onload = function() {
				"use strict";

				// Constants
				const MIN_DEPTH = 0;
				const MAX_DEPTH = 100;
				const LOGO_WIDTH = 128;
				const LOGO_HEIGHT = 128;
				const LOGO_SPEED = 100;
				const LOGO_COUNT = 100;

				// Globals
				const canvas = document.getElementById("canvas");
				const ctx = canvas.getContext("2d", { alpha: false });
				var last_time = Date.now();
				var dt = 0.0;
				const logo_img = document.getElementById("logo");

				// Helper Functions
				function rand(min, max) {
					return Math.random() * (max - min) + min;
				}
				function width() { return document.body.offsetWidth; }
				function height() { return document.body.offsetHeight; }
				function normalize(x, min, max) {
					return (x - min) / (max - min);
				}

				class Logo {
					constructor() {
						this.colors = [
							"#FF0000",
							"#00FF00",
							"#0000FF"
						];

						this.regenerate(rand(MIN_DEPTH, MAX_DEPTH));
					}

					regenerate(depth) {
						this.depth = depth || MIN_DEPTH;
						this.x = rand(0, width());
						this.y = rand(0, height());
						this.color = this.colors[Math.floor(rand(0, this.colors.length))];
					}

					update() {
						if ((this.depth += LOGO_SPEED * dt) > MAX_DEPTH)
							this.regenerate();
						
						const z = normalize(this.depth, MIN_DEPTH, MAX_DEPTH);
						const w = z * LOGO_WIDTH;
						const h = z * LOGO_HEIGHT;

						// Render
						ctx.drawImage(logo_img, this.x - w * 0.5, this.y - h * 0.5, w, h);
						ctx.globalCompositeOperation = "source-atop";
						ctx.fillStyle = this.color;
						ctx.fillRect(this.x - w * 0.5, this.y - h * 0.5, w, h);
					}
				}

				// Setup
				const logos = new Array(LOGO_COUNT);
				for (var i = 0; i < LOGO_COUNT; ++i)
					logos[i] = new Logo();

				// Main Loop
				requestAnimationFrame(function loop() {
					const curr_time = Date.now();
					dt = (curr_time - last_time) * 0.001;
					last_time = curr_time;

					canvas.width = width();
					canvas.height = height();

					for (var i = 0; i < LOGO_COUNT; ++i)
						logos[i].update();
					
					/*ctx.drawImage(img, width() * 0.5, height() * 0.5);
					
					ctx.globalCompositeOperation = "source-atop";
					ctx.fillStyle = "#FF0000";
					ctx.fillRect(width() * 0.5, height() * 0.5, img.width, img.height);*/

					requestAnimationFrame(loop);
				});
			}
		</script>
	</body>
</html>